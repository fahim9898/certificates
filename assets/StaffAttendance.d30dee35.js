import{d as O,r as o,q as P,c as a,F as h,j as t,i as m}from"./vendor.436bddb5.js";import{b as U,u as $,B as q,g as n,q as B,a as K,w as k}from"./index.039e5ba8.js";import{C as f}from"./Card.50e90fed.js";import{I as M}from"./InputLable.84bb3852.js";import{F as Y}from"./FingerPrintScan.51e43443.js";const Z=()=>{O(e=>e.user.currentUser);const[H,D]=o.exports.useState(!1),[S,R]=o.exports.useState(!1),[b,w]=o.exports.useState([]),{isLoading:W,callback:v}=U(),N=P().date||`${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`,[u,T]=o.exports.useState(""),[p,C]=o.exports.useState([]),{data:i,setData:_,loadingDone:d}=$({method:"get",url:k+"/"+N},e=>(C(e.data?.attendances),e.data?.attendances));o.exports.useEffect(()=>{C(i?.filter(e=>!!(e.staff_user.staff_name.toLowerCase().includes(u.toLowerCase())||e.staff_user.id.toString().toLowerCase().includes(u.toLowerCase())))?.sort((e,s)=>e.checkin_time&&s.checkin_time?-1:1))},[u]);const y="Staff Attendance",I=[{name:"Home",link:"/branch-admin"},{name:"Staff Attendance",link:"/branch-admin/staff-attendance"}];o.exports.useEffect(()=>{let e;return d&&(w(i.map((s,c)=>({index:c,c_second:0,time:"00:00:00"}))),e=setInterval(()=>{D(s=>!s)},1e3)),()=>{clearInterval(e)}},[d,S]);function g(){return N==`${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`}function E(e,s){let c=i[s].checkin_time,l=i[s].checkout_time;if(!c||l)return e;let r=m().startOf("day");if(e.c_second==0){let L=m(c,"HH:mm:ss"),j=m(m(new Date).format("HH:mm:ss"),"HH:mm:ss");var F=m.duration(j.diff(L));e.c_second=F.asSeconds(),r.add(e.c_second,"second")}else r.add(e.c_second,"second");return{...e,c_second:e.c_second+1,time:r.format("HH:mm:ss")}}o.exports.useEffect(()=>{b&&w(b.map((e,s)=>E(e,s)))},[H]);function x(e){v({url:k+"/"+e.id,method:"patch",success:s=>{let c=s.data.attendance;window.Notify({message:s.data.message,status:"success"}),_(l=>l.map(r=>r.id==e.id?c:r))}})}function A(e){v({url:k+"/"+e.id,method:"patch",success:s=>{let c=s.data.attendance;window.Notify({message:s.data.message,status:"success"}),_(l=>l.map(r=>r.id==e.id?c:r))}})}return a(h,{children:[t(q,{title:y,links:I}),a("div",{id:"staff-attendance-table",className:"d-none",children:[t("div",{className:"row",children:t("div",{className:"col-12 mb-2",children:a("h3",{children:["Attendance - ",N]})})}),a("table",{className:"table",children:[t("thead",{children:a("tr",{children:[t("th",{children:"Name"}),t("th",{children:"Type"}),t("th",{children:"Login"}),t("th",{children:"Logout"}),t("th",{children:"Status"})]})}),t("tbody",{children:i&&i.map((e,s)=>a("tr",{children:[t("td",{children:n(()=>e.staff_user.staff_name)}),t("td",{children:n(()=>e.staff_user.staff_type)}),t("td",{children:n(()=>e.checkin_time)}),t("td",{children:n(()=>e.checkout_time)}),t("td",{children:n(()=>e.checkin_time?"Present":"Absent")})]}))})]})]}),t("div",{className:"filter-options",style:{paddingTop:"10px",paddingBottom:"0px",marginBottom:"0px"},children:a("div",{className:"row w-100",children:[t(M.LabelInput,{style:{width:"min(500px, 85vw)"},className:"form-control h-100",type:"text",required:!0,value:u,onChange:e=>T(e.target.value),label:"Enter Name/Id",invalidText:"Name is required"}),i&&t("div",{className:"input-grp mt-0 ml-2 float-right",children:t("div",{className:"btn btn-info",onClick:()=>{B("staff-attendance-table")},children:"Print"})})]})}),a("div",{className:"row mt-3",children:[i&&p&&i.filter(e=>p.some(s=>s.id==e.id)).map((e,s)=>t("div",{className:"col-xl-4 col-md-6",children:a(f,{className:"attendance-card",children:[a("div",{className:"row",children:[t("div",{className:"col-md-4 py-1",children:t("img",{className:"attendance-img",src:K(n(()=>e.staff_user.profile_pic)),alt:""})}),a("div",{className:"col-md-8 py-1",children:[t("h5",{children:n(()=>e.staff_user.staff_name)}),a("p",{className:"mb-0",children:[t("i",{className:"fa fa-phone"}),"\xA0\xA0",n(()=>e.staff_user.contact_no)]}),a("p",{className:"mb-0",children:[t("i",{className:"feather icon-clock"}),"\xA0\xA0",n(()=>e.staff_user.working_hours)," Hours"]}),a("div",{className:"row pt-1",children:[t("div",{className:"col-6",children:t("p",{className:"mb-0 text-center",children:(()=>{if(e.checkin_time)return a(h,{children:[t("span",{className:"font-weight-bold",children:"Check In"})," ",t("br",{}),n(()=>e.checkin_time)]});if(!g())return a(h,{children:[t("span",{className:"font-weight-bold",children:"Absent"})," ",t("br",{})]})})()})}),t("div",{className:"col-6 border-left",children:t("p",{className:"mb-0 text-center",children:(()=>{if(e.checkout_time)return a(h,{children:[t("span",{className:"font-weight-bold",children:"Checked Out"})," ",t("br",{}),n(()=>e.checkout_time)]});if(e.checkin_time&&g())return a(h,{children:[t("span",{className:"font-weight-bold",children:"Time"}),t("br",{}),n(()=>b[s].time)]});if(e.checkin_time&&!g())return a(h,{children:[t("span",{className:"font-weight-bold",children:"Not Checkout"}),t("br",{})]})})()})})]})]}),t("span",{className:"staff-type",children:n(()=>e.staff_user.staff_type)})]}),g()&&t("div",{className:"row",children:t("div",{className:"col-md-12 border-top",children:(()=>{if(!e.checkin_time&&!e.checkout_time)return t("span",{className:"c-mt-1 c-btn float-right badge badge-success",onClick:()=>window.confirmAlert(()=>x(e)),children:"Check In"});if(e.checkin_time&&!e.checkout_time)return t("span",{className:"c-mt-1 c-btn float-right badge badge-danger",onClick:()=>window.confirmAlert(()=>A(e)),children:"Check Out"})})()})})]})},e.id)),i&&p&&t(Y,{users:i.filter(e=>p.some(s=>s.id==e.id)),scanComplete:e=>{setTimeout(()=>{console.log(e);let s={};if(_(c=>(s=c.filter(l=>l.id==e.id)[0],c)),console.log(s),!s.checkin_time&&!s.checkout_time)console.log("CHECKED IN"),x(e);else if(s.checkin_time&&!s.checkout_time){let c=m(s.checkin_time,"HH:mm:ss"),l=m(m(new Date).format("HH:mm:ss"),"HH:mm:ss"),r=l.diff(c,"minute");console.log("CHECKOUT ->",r,c,l),r>5?(console.log("CHECKED OUT"),A(e)):window.Notify({message:"Please wait for 5 minutes to checkout",status:"warning"})}else window.Notify({message:"Already Checked In",status:"warning"})},0)},frequency:2,timeout:0}),!i&&a(h,{children:[t("div",{className:"col-md-4",children:t(f,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(f,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(f,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(f,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(f,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(f,{loadingDone:d})})]})]})]})};export{Z as default};
