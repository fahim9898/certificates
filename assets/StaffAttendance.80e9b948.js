import{c as $,r as l,q as B,b as s,F as o,j as t,i as f}from"./vendor.61ffbfff.js";import{b as q,u as O,B as U,g as c,q as M,a as P,w as g}from"./index.d0bee3a0.js";import{C as m}from"./Card.a57d113a.js";import{I as Y}from"./InputLable.103d759b.js";const V=()=>{$(e=>e.user.currentUser);const[A,C]=l.exports.useState(!1),[S,R]=l.exports.useState(!1),[b,_]=l.exports.useState([]),{isLoading:W,callback:k}=q(),N=B().date||`${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`,[u,D]=l.exports.useState(""),[w,v]=l.exports.useState([]),{data:n,setData:x,loadingDone:i}=O({method:"get",url:g+"/"+N},e=>(v(e.data?.attendances),e.data?.attendances));l.exports.useEffect(()=>{v(n?.filter(e=>!!(e.staff_user.staff_name.toLowerCase().includes(u.toLowerCase())||e.staff_user.id.toString().toLowerCase().includes(u.toLowerCase())))?.sort((e,a)=>e.checkin_time&&a.checkin_time?-1:1))},[u]);const T="Staff Attendance",y=[{name:"Home",link:"/branch-admin"},{name:"Staff Attendance",link:"/branch-admin/staff-attendance"}];l.exports.useEffect(()=>{let e;return i&&(_(n.map((a,d)=>({index:d,c_second:0,time:"00:00:00"}))),e=setInterval(()=>{C(a=>!a)},1e3)),()=>{clearInterval(e)}},[i,S]);function p(){return N==`${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`}function H(e,a){let d=n[a].checkin_time,h=n[a].checkout_time;if(!d||h)return e;let r=f().startOf("day");if(e.c_second==0){let F=f(d,"HH:mm:ss"),E=f(f(new Date).format("HH:mm:ss"),"HH:mm:ss");var j=f.duration(E.diff(F));e.c_second=j.asSeconds(),r.add(e.c_second,"second")}else r.add(e.c_second,"second");return{...e,c_second:e.c_second+1,time:r.format("HH:mm:ss")}}l.exports.useEffect(()=>{b&&_(b.map((e,a)=>H(e,a)))},[A]);function I(e){k({url:g+"/"+e.id,method:"patch",success:a=>{let d=a.data.attendance;window.Notify({message:a.data.message,status:"success"});let h=n.map(r=>r.id==e.id?d:r);x(h)}})}function L(e){k({url:g+"/"+e.id,method:"patch",success:a=>{let d=a.data.attendance;window.Notify({message:a.data.message,status:"success"});let h=n.map(r=>r.id==e.id?d:r);x(h)}})}return s(o,{children:[t(U,{title:T,links:y}),s("div",{id:"staff-attendance-table",className:"d-none",children:[t("div",{className:"row",children:t("div",{className:"col-12 mb-2",children:s("h3",{children:["Attendance - ",N]})})}),s("table",{className:"table",children:[t("thead",{children:s("tr",{children:[t("th",{children:"Name"}),t("th",{children:"Type"}),t("th",{children:"Login"}),t("th",{children:"Logout"}),t("th",{children:"Status"})]})}),t("tbody",{children:n&&n.map((e,a)=>s("tr",{children:[t("td",{children:c(()=>e.staff_user.staff_name)}),t("td",{children:c(()=>e.staff_user.staff_type)}),t("td",{children:c(()=>e.checkin_time)}),t("td",{children:c(()=>e.checkout_time)}),t("td",{children:c(()=>e.checkin_time?"Present":"Absent")})]}))})]})]}),t("div",{className:"filter-options",style:{paddingTop:"10px",paddingBottom:"0px",marginBottom:"0px"},children:s("div",{className:"row w-100",children:[t(Y.LabelInput,{style:{width:"min(500px, 85vw)"},className:"form-control h-100",type:"text",required:!0,value:u,onChange:e=>D(e.target.value),label:"Enter Name/Id",invalidText:"Name is required"}),n&&t("div",{className:"input-grp mt-0 ml-2 float-right",children:t("div",{className:"btn btn-info",onClick:()=>{M("staff-attendance-table")},children:"Print"})})]})}),s("div",{className:"row mt-3",children:[n&&w&&n.filter(e=>w.some(a=>a.id==e.id)).map((e,a)=>t("div",{className:"col-xl-4 col-md-6",children:s(m,{className:"attendance-card",children:[s("div",{className:"row",children:[t("div",{className:"col-md-4 py-1",children:t("img",{className:"attendance-img",src:P(c(()=>e.staff_user.profile_pic)),alt:""})}),s("div",{className:"col-md-8 py-1",children:[t("h5",{children:c(()=>e.staff_user.staff_name)}),s("p",{className:"mb-0",children:[t("i",{className:"fa fa-phone"}),"\xA0\xA0",c(()=>e.staff_user.contact_no)]}),s("p",{className:"mb-0",children:[t("i",{className:"feather icon-clock"}),"\xA0\xA0",c(()=>e.staff_user.working_hours)," Hours"]}),s("div",{className:"row pt-1",children:[t("div",{className:"col-6",children:t("p",{className:"mb-0 text-center",children:(()=>{if(e.checkin_time)return s(o,{children:[t("span",{className:"font-weight-bold",children:"Check In"})," ",t("br",{}),c(()=>e.checkin_time)]});if(!p())return s(o,{children:[t("span",{className:"font-weight-bold",children:"Absent"})," ",t("br",{})]})})()})}),t("div",{className:"col-6 border-left",children:t("p",{className:"mb-0 text-center",children:(()=>{if(e.checkout_time)return s(o,{children:[t("span",{className:"font-weight-bold",children:"Checked Out"})," ",t("br",{}),c(()=>e.checkout_time)]});if(e.checkin_time&&p())return s(o,{children:[t("span",{className:"font-weight-bold",children:"Time"}),t("br",{}),c(()=>b[a].time)]});if(e.checkin_time&&!p())return s(o,{children:[t("span",{className:"font-weight-bold",children:"Not Checkout"}),t("br",{})]})})()})})]})]}),t("span",{className:"staff-type",children:c(()=>e.staff_user.staff_type)})]}),p()&&t("div",{className:"row",children:t("div",{className:"col-md-12 border-top",children:(()=>{if(!e.checkin_time&&!e.checkout_time)return t("span",{className:"c-mt-1 c-btn float-right badge badge-success",onClick:()=>window.confirmAlert(()=>I(e)),children:"Check In"});if(e.checkin_time&&!e.checkout_time)return t("span",{className:"c-mt-1 c-btn float-right badge badge-danger",onClick:()=>window.confirmAlert(()=>L(e)),children:"Check Out"})})()})})]})},e.id)),!n&&s(o,{children:[t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})})]})]})]})};export{V as default};
