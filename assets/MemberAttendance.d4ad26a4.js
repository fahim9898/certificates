import{c as M,r as l,b as c,F as h,j as t,i as u}from"./vendor.61ffbfff.js";import{b as B,u as F,B as O,g as r,q as U,a as q,x as p}from"./index.f3575213.js";import{C as m}from"./Card.a57d113a.js";import{I as $}from"./InputLable.103d759b.js";const J=()=>{M(e=>e.user.currentUser);const[_,w]=l.exports.useState(!1),[x,P]=l.exports.useState(!1),[b,N]=l.exports.useState([]),{isLoading:R,callback:g}=B(),[f,A]=l.exports.useState(""),[C,v]=l.exports.useState([]),T=`${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`,{data:s,setData:k,loadingDone:i}=F({method:"get",url:p},e=>(v(e.data?.attendances),e.data?.attendances));l.exports.useEffect(()=>{v(s?.filter(e=>!!(e.member.member_name.toLowerCase().includes(f.toLowerCase())||e.member.id.toString().toLowerCase().includes(f.toLowerCase())))?.sort((e,a)=>e.checkin_time&&a.checkin_time?-1:1))},[f]);const S="Member Attendance",y=[{name:"Home",link:"/branch-admin"},{name:"Member Attendance",link:"/branch-admin/member-attendance"}];l.exports.useEffect(()=>{let e;return i&&(N(s.map((a,d)=>({index:d,c_second:0,time:"00:00:00"}))),e=setInterval(()=>{w(a=>!a)},1e3)),()=>{clearInterval(e)}},[i,x]);function I(e,a){let d=s[a].checkin_time,o=s[a].checkout_time;if(!d||o)return e;let n=u().startOf("day");if(e.c_second==0){let j=u(d,"HH:mm:ss"),E=u(u(new Date).format("HH:mm:ss"),"HH:mm:ss");var H=u.duration(E.diff(j));e.c_second=H.asSeconds(),n.add(e.c_second,"second")}else n.add(e.c_second,"second");return{...e,c_second:e.c_second+1,time:n.format("HH:mm:ss")}}l.exports.useEffect(()=>{b&&N(b.map((e,a)=>I(e,a)))},[_]);function L(e){g({url:p+"/"+e.id,method:"patch",success:a=>{let d=a.data.attendance;window.Notify({message:a.data.message,status:"success"});let o=s.map(n=>n.id==e.id?d:n);k(o)}})}function D(e){g({url:p+"/"+e.id,method:"patch",success:a=>{let d=a.data.attendance;window.Notify({message:a.data.message,status:"success"});let o=s.map(n=>n.id==e.id?d:n);k(o)}})}return c(h,{children:[t(O,{title:S,links:y}),c("div",{id:"member-attendance-table",className:"d-none",children:[t("div",{className:"row",children:t("div",{className:"col-12 mb-2",children:c("h3",{children:["Attendance - ",T]})})}),c("table",{className:"table",children:[t("thead",{children:c("tr",{children:[t("th",{children:"Name"}),t("th",{children:"Login"}),t("th",{children:"Logout"}),t("th",{children:"Status"})]})}),t("tbody",{children:s&&s.map((e,a)=>c("tr",{children:[t("td",{children:r(()=>e.member.member_name)}),t("td",{children:r(()=>e.checkin_time)}),t("td",{children:r(()=>e.checkout_time)}),t("td",{children:r(()=>e.checkin_time?"Present":"Absent")})]},e.id))})]})]}),t("div",{className:"filter-options",style:{paddingTop:"10px",paddingBottom:"0px",marginBottom:"0px"},children:c("div",{className:"row w-100",children:[t($.LabelInput,{style:{width:"min(500px, 85vw)"},className:"form-control h-100",type:"text",required:!0,value:f,onChange:e=>A(e.target.value),label:"Enter Name/Id",invalidText:"Name is required"}),s&&t("div",{className:"input-grp mt-0 ml-2 float-right",children:t("div",{className:"btn btn-info",onClick:()=>{U("member-attendance-table")},children:"Print"})})]})}),c("div",{className:"row mt-3",children:[s&&s.filter(e=>C.some(a=>a.id==e.id)).map((e,a)=>t("div",{className:"col-xl-4 col-md-6",children:c(m,{className:"attendance-card",children:[c("div",{className:"row",children:[t("div",{className:"col-md-4 py-1",children:t("img",{className:"attendance-img",src:q(r(()=>e.member.profile_pic)),alt:""})}),c("div",{className:"col-md-8 py-1",children:[c("h5",{children:[e.member.gender?t("i",{className:"fa fa-female"}):t("i",{className:"fa fa-male"}),"\xA0\xA0",r(()=>e.member.member_name)]}),c("p",{className:"mb-0",children:[t("i",{className:"fa fa-phone"}),"\xA0\xA0",r(()=>e.member.contact_no)]}),c("div",{className:"row pt-1",children:[t("div",{className:"col-6",children:t("p",{className:"mb-0 text-center",children:(()=>{if(e.checkin_time)return c(h,{children:[t("span",{className:"font-weight-bold",children:"Check In"})," ",t("br",{}),r(()=>e.checkin_time)]})})()})}),t("div",{className:"col-6 border-left",children:t("p",{className:"mb-0 text-center",children:(()=>{if(e.checkout_time)return c(h,{children:[t("span",{className:"font-weight-bold",children:"Checked Out"})," ",t("br",{}),r(()=>e.checkout_time)]});if(e.checkin_time)return c(h,{children:[t("span",{className:"font-weight-bold",children:"Time"}),t("br",{}),r(()=>b[a].time)]})})()})})]})]}),t("span",{className:"member-type",children:r(()=>e.member.member_type)})]}),t("div",{className:"row",children:t("div",{className:"col-md-12 border-top",children:(()=>{if(!e.checkin_time&&!e.checkout_time)return t("span",{className:"c-mt-1 c-btn float-right badge badge-success",onClick:()=>window.confirmAlert(()=>L(e)),children:"Check In"});if(e.checkin_time&&!e.checkout_time)return t("span",{className:"c-mt-1 c-btn float-right badge badge-danger",onClick:()=>window.confirmAlert(()=>D(e)),children:"Check Out"})})()})})]})},e.id)),!s&&c(h,{children:[t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})}),t("div",{className:"col-md-4",children:t(m,{loadingDone:i})})]})]})]})};export{J as default};
