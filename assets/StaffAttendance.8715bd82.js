import{r as o,j as t,F as u,c as B,q as j,b as a,i as h}from"./vendor.61ffbfff.js";import{b as q,u as R,B as K,g as i,q as G,a as V,w as H}from"./index.f3575213.js";import{C as N}from"./Card.a57d113a.js";import{I as $}from"./InputLable.103d759b.js";const Q=(k,A)=>new Promise(C=>{setTimeout(()=>{C({httpStaus:!0,data:{ErrorCode:"0",ErrorDescription:"",IsoTemplate:"Rk1SACAyMAAAAADSAAABPAFiAMUAxQEAAAAoHkDIAOTzAEDaAOpzAEDkAMN4AIDfALN3AEDyAQ3XAEDwAKbqAEEJAM1nAIEGARTUAIC1AUnVAEC9AVdSAICkANiLAICdAP8SAEC7AKt7AECyAKb5AECxATDGAID7ARlYAIBpAQOvAECVAI0EAECtAUZCAIByAIcOAECnAPWcAICgAMYBAID3AN/hAIB7AQG0AEBsAOygAEC5AJOCAECGAKAEAEC8AUTZAEDGAU1ZAEC3AG39AAAA"}})},3e3)}),Y=(k,A)=>new Promise(C=>{setTimeout(()=>{C({httpStaus:!0,data:{ErrorCode:"0",Status:Math.random()<.05}})},0)}),Z=({scanComplete:k=x=>{},users:A=[],quality:C=55,timeout:O=10,frequency:w=15,spinning:S=!1,...M})=>{const[x,v]=o.exports.useState(!1),[I,p]=o.exports.useState(0),[F,g]=o.exports.useState("Scan");let f=!1;o.exports.useEffect(()=>(d(),()=>{f=!0}),[]);let n=async function(){let r=[];if(f)return;console.log("SCAN TAKE TIME: ",Date.now());let y=await Q();r.push(y),p((r.length/w*100).toFixed(0));for(let E in A)for(let b=0;b<3;b++){let e=await Y(A[E].staff_user["iso"+(b+1)],r[0].data.IsoTemplate);if(e.httpStaus&&e.data.ErrorCode=="0"&&e.data.Status){console.log("FINGER PRINT MATCHED"),D(A[E]);return}}console.log("NO USER FOUND"),n()};async function _(){f=!1;try{n()}catch(r){f=!0,console.log(r),window.Notify({message:r,status:"error"}),T()}}const d=()=>{v(!0),p(0),setTimeout(()=>{_()},100)},D=r=>{g("Rescan"),v(!1),k(r),n()},T=()=>{f=!0,g("Rescan"),console.log("Clicked cancel button",f),v(!1)};return t(u,{children:t(u,{})})},ee=()=>{B(e=>e.user.currentUser);const[k,A]=o.exports.useState(!1),[C,O]=o.exports.useState(!1),[w,S]=o.exports.useState([]),{isLoading:M,callback:x}=q(),I=j().date||`${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`,[p,F]=o.exports.useState(""),[g,f]=o.exports.useState([]),{data:n,setData:_,loadingDone:d}=R({method:"get",url:H+"/"+I},e=>(f(e.data?.attendances),e.data?.attendances));o.exports.useEffect(()=>{f(n?.filter(e=>!!(e.staff_user.staff_name.toLowerCase().includes(p.toLowerCase())||e.staff_user.id.toString().toLowerCase().includes(p.toLowerCase())))?.sort((e,s)=>e.checkin_time&&s.checkin_time?-1:1))},[p]);const D="Staff Attendance",T=[{name:"Home",link:"/branch-admin"},{name:"Staff Attendance",link:"/branch-admin/staff-attendance"}];o.exports.useEffect(()=>{let e;return d&&(S(n.map((s,c)=>({index:c,c_second:0,time:"00:00:00"}))),e=setInterval(()=>{A(s=>!s)},1e3)),()=>{clearInterval(e)}},[d,C]);function r(){return I==`${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`}function y(e,s){let c=n[s].checkin_time,m=n[s].checkout_time;if(!c||m)return e;let l=h().startOf("day");if(e.c_second==0){let U=h(c,"HH:mm:ss"),L=h(h(new Date).format("HH:mm:ss"),"HH:mm:ss");var P=h.duration(L.diff(U));e.c_second=P.asSeconds(),l.add(e.c_second,"second")}else l.add(e.c_second,"second");return{...e,c_second:e.c_second+1,time:l.format("HH:mm:ss")}}o.exports.useEffect(()=>{w&&S(w.map((e,s)=>y(e,s)))},[k]);function E(e){x({url:H+"/"+e.id,method:"patch",success:s=>{let c=s.data.attendance;window.Notify({message:s.data.message,status:"success"}),_(m=>m.map(l=>l.id==e.id?c:l))}})}function b(e){x({url:H+"/"+e.id,method:"patch",success:s=>{let c=s.data.attendance;window.Notify({message:s.data.message,status:"success"}),_(m=>m.map(l=>l.id==e.id?c:l))}})}return a(u,{children:[t(K,{title:D,links:T}),a("div",{id:"staff-attendance-table",className:"d-none",children:[t("div",{className:"row",children:t("div",{className:"col-12 mb-2",children:a("h3",{children:["Attendance - ",I]})})}),a("table",{className:"table",children:[t("thead",{children:a("tr",{children:[t("th",{children:"Name"}),t("th",{children:"Type"}),t("th",{children:"Login"}),t("th",{children:"Logout"}),t("th",{children:"Status"})]})}),t("tbody",{children:n&&n.map((e,s)=>a("tr",{children:[t("td",{children:i(()=>e.staff_user.staff_name)}),t("td",{children:i(()=>e.staff_user.staff_type)}),t("td",{children:i(()=>e.checkin_time)}),t("td",{children:i(()=>e.checkout_time)}),t("td",{children:i(()=>e.checkin_time?"Present":"Absent")})]}))})]})]}),t("div",{className:"filter-options",style:{paddingTop:"10px",paddingBottom:"0px",marginBottom:"0px"},children:a("div",{className:"row w-100",children:[t($.LabelInput,{style:{width:"min(500px, 85vw)"},className:"form-control h-100",type:"text",required:!0,value:p,onChange:e=>F(e.target.value),label:"Enter Name/Id",invalidText:"Name is required"}),n&&t("div",{className:"input-grp mt-0 ml-2 float-right",children:t("div",{className:"btn btn-info",onClick:()=>{G("staff-attendance-table")},children:"Print"})})]})}),a("div",{className:"row mt-3",children:[n&&g&&n.filter(e=>g.some(s=>s.id==e.id)).map((e,s)=>t("div",{className:"col-xl-4 col-md-6",children:a(N,{className:"attendance-card",children:[a("div",{className:"row",children:[t("div",{className:"col-md-4 py-1",children:t("img",{className:"attendance-img",src:V(i(()=>e.staff_user.profile_pic)),alt:""})}),a("div",{className:"col-md-8 py-1",children:[t("h5",{children:i(()=>e.staff_user.staff_name)}),a("p",{className:"mb-0",children:[t("i",{className:"fa fa-phone"}),"\xA0\xA0",i(()=>e.staff_user.contact_no)]}),a("p",{className:"mb-0",children:[t("i",{className:"feather icon-clock"}),"\xA0\xA0",i(()=>e.staff_user.working_hours)," Hours"]}),a("div",{className:"row pt-1",children:[t("div",{className:"col-6",children:t("p",{className:"mb-0 text-center",children:(()=>{if(e.checkin_time)return a(u,{children:[t("span",{className:"font-weight-bold",children:"Check In"})," ",t("br",{}),i(()=>e.checkin_time)]});if(!r())return a(u,{children:[t("span",{className:"font-weight-bold",children:"Absent"})," ",t("br",{})]})})()})}),t("div",{className:"col-6 border-left",children:t("p",{className:"mb-0 text-center",children:(()=>{if(e.checkout_time)return a(u,{children:[t("span",{className:"font-weight-bold",children:"Checked Out"})," ",t("br",{}),i(()=>e.checkout_time)]});if(e.checkin_time&&r())return a(u,{children:[t("span",{className:"font-weight-bold",children:"Time"}),t("br",{}),i(()=>w[s].time)]});if(e.checkin_time&&!r())return a(u,{children:[t("span",{className:"font-weight-bold",children:"Not Checkout"}),t("br",{})]})})()})})]})]}),t("span",{className:"staff-type",children:i(()=>e.staff_user.staff_type)})]}),r()&&t("div",{className:"row",children:t("div",{className:"col-md-12 border-top",children:(()=>{if(!e.checkin_time&&!e.checkout_time)return t("span",{className:"c-mt-1 c-btn float-right badge badge-success",onClick:()=>window.confirmAlert(()=>E(e)),children:"Check In"});if(e.checkin_time&&!e.checkout_time)return t("span",{className:"c-mt-1 c-btn float-right badge badge-danger",onClick:()=>window.confirmAlert(()=>b(e)),children:"Check Out"})})()})})]})},e.id)),n&&g&&t(Z,{users:n.filter(e=>g.some(s=>s.id==e.id)),scanComplete:e=>{setTimeout(()=>{console.log(e);let s={};if(_(c=>(s=c.filter(m=>m.id==e.id)[0],c)),console.log(s),!s.checkin_time&&!s.checkout_time)console.log("CHECKED IN"),E(e);else if(s.checkin_time&&!s.checkout_time){let c=h(s.checkin_time,"HH:mm:ss"),m=h(h(new Date).format("HH:mm:ss"),"HH:mm:ss"),l=m.diff(c,"minute");console.log("CHECKOUT ->",l,c,m),l>5?(console.log("CHECKED OUT"),b(e)):window.Notify({message:"Please wait for 5 minutes to checkout",status:"warning"})}else window.Notify({message:"Already Checked In",status:"warning"})},0)},frequency:2,timeout:0}),!n&&a(u,{children:[t("div",{className:"col-md-4",children:t(N,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(N,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(N,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(N,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(N,{loadingDone:d})}),t("div",{className:"col-md-4",children:t(N,{loadingDone:d})})]})]})]})};export{ee as default};
